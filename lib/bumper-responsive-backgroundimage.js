// Generated by CoffeeScript 1.7.1

/*
 * * bumper | responsive | images | background
 * * https://github.com/brewster1134/bumper
 * *
 * * @version 0.1.0
 * * @author Ryan Brewster
 * * Copyright (c) 2014
 * * Licensed under the MIT license.
 */

(function() {
  (function(root, factory) {
    if (typeof define === 'function' && define.amd) {
      return define(['jquery', 'bumper-core'], function($) {
        return factory($);
      });
    } else {
      return window.Bumper.Responsive.BackgroundImage = factory(jQuery);
    }
  })(this, function($) {
    return {
      resizeEl: function($el, breakpoint) {
        var $img, bpParams, defaultParams, params, url;
        url = $el.attr("data-bumper-responsive-backgroundimage-url-" + breakpoint) || $el.attr('data-bumper-responsive-backgroundimage-url');
        if (!url) {
          console.warn("data-bumper-responsive-backgroundimage-url[-" + breakpoint + "] is not set.", $el);
          return;
        }
        defaultParams = $el.attr('data-bumper-responsive-backgroundimage-url-params');
        bpParams = $el.attr("data-bumper-responsive-backgroundimage-url-params-" + breakpoint);
        params = [defaultParams, bpParams].filter(function(n) {
          return n !== void 0 && n !== null && n !== '';
        });
        params = params.length ? "?" + (params.join('&')) : '';
        $img = $('<img/>');
        $img.load(function() {
          $el.attr('data-bumper-breakpoint', breakpoint);
          $el.css({
            backgroundImage: "url(" + ($(this).attr('src')) + ")"
          });
          return $el.trigger('bumper.responsive.backgroundimage.loaded');
        });
        return $img.attr('src', "" + url + params);
      },
      resizeAll: function(breakpoint) {
        var _this;
        _this = this;
        return $('.bumper-responsive-backgroundimage').each(function() {
          return _this.resizeEl($(this), breakpoint);
        });
      }
    };
  });

}).call(this);
