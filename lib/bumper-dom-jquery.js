// Generated by CoffeeScript 1.9.3

/*
 * * bumper | dom | jquery
 * * https://github.com/brewster1134/bumper
 * *
 * * @author Ryan Brewster
 * * Copyright (c) 2014
 * * Licensed under the MIT license.
 */

(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  (function(root, factory) {
    if (typeof define === 'function' && define.amd) {
      return define(['jquery', 'bumper-core'], function($) {
        return factory($);
      });
    } else if (typeof exports !== 'undefined') {
      return module.exports = factory(jQuery);
    } else {
      return factory(jQuery);
    }
  })(this, function($) {
    var BumperDom;
    BumperDom = (function(superClass) {
      extend(BumperDom, superClass);

      function BumperDom() {
        return BumperDom.__super__.constructor.apply(this, arguments);
      }

      BumperDom.prototype.options = {
        parents: false
      };

      BumperDom.prototype.getElementData = function(string, rootEl) {
        var $element, $rootEl, arg, base, base1, i, index, j, k, key, keyValue, len, len1, len2, match, matchData, matches, option, options, ref, regex, stringArgs, stringArray, stringMethod, stringMethodArgs, stringOptions, stringOptionsObject, stringSelector, value;
        $rootEl = $(rootEl);
        regex = /\{([^&]+)\}/g;
        matches = string.match(regex);
        if (!matches) {
          return string;
        }
        for (i = 0, len = matches.length; i < len; i++) {
          match = matches[i];
          stringArray = match.replace(/[{}]/g, '').split(':');
          stringSelector = stringArray[0];
          stringMethodArgs = stringArray[1];
          stringOptions = stringArray[2];
          stringOptionsObject = {};
          if (stringOptions) {
            ref = stringOptions.split(',');
            for (j = 0, len1 = ref.length; j < len1; j++) {
              option = ref[j];
              keyValue = option.split('=');
              key = keyValue[0].trim();
              value = keyValue[1].trim();
              stringOptionsObject[key] = window.Bumper.Core.castType(value);
            }
          }
          options = $.extend({}, this.options, stringOptionsObject);
          stringArgs = stringMethodArgs.split(',');
          stringMethod = stringArgs.shift();
          $element = $rootEl.parent().closest("" + stringSelector);
          if (options.parents === false && !$element.length) {
            $element = $("" + stringSelector).first();
          }
          if (!$element.length) {
            $element = $rootEl.parent().closest(':visible');
          }
          if (!$element.length) {
            $element = $('body');
          }
          for (index = k = 0, len2 = stringArgs.length; k < len2; index = ++k) {
            arg = stringArgs[index];
            stringArgs[index] = window.Bumper.Core.castType(arg);
          }
          value = $element[stringMethod].apply($element, stringArgs);
          matchData = {
            element: $element,
            selector: stringSelector,
            method: stringMethod,
            "arguments": stringArgs,
            options: options
          };
          value = (typeof (base = $element.data('bumper-dom-function')) === "function" ? base(value, matchData) : void 0) || value;
          value = (typeof (base1 = $rootEl.data('bumper-dom-function')) === "function" ? base1(value, matchData) : void 0) || value;
          string = string.replace(match, value);
        }
        return string;
      };

      return BumperDom;

    })(window.Bumper.Core.Module);
    window.Bumper || (window.Bumper = {});
    if (window.Bumper.Dom != null) {
      console.warn('There is already a dom handler loaded. It will be replaced by the jQuery handler', window.Bumper.Dom);
    }
    return window.Bumper.Dom = new BumperDom;
  });

}).call(this);
